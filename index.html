<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FPL Debugger</title>
    <style>
        body { font-family: monospace; background: #f0f4f8; padding: 20px; }
        .card { background: white; padding: 20px; border-radius: 8px; max-width: 500px; margin: 0 auto; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        input { padding: 10px; width: 60%; }
        button { padding: 10px 20px; background: #00ff87; border: none; font-weight: bold; cursor: pointer; }
        #debug-log { background: #333; color: #0f0; padding: 15px; margin-top: 20px; border-radius: 5px; white-space: pre-wrap; font-size: 12px; min-height: 100px; }
        .error { color: #ff4444; }
    </style>
</head>
<body>

<div class="card">
    <h2>FPL Connection Debugger</h2>
    <input type="number" id="teamIdInput" value="12713236">
    <button onclick="runDebug()">Check Points</button>
    
    <div id="result" style="margin-top: 20px; font-size: 1.2em; font-weight: bold;"></div>
</div>

<div id="debug-log">Waiting for input...</div>

<script>
    // Trying a different proxy (AllOrigins) to see if it helps
    const PROXY_URL = "https://api.allorigins.win/raw?url=";
    const BASE_URL = "https://fantasy.premierleague.com/api";

    function log(msg, isError = false) {
        const logDiv = document.getElementById('debug-log');
        const timestamp = new Date().toLocaleTimeString();
        const color = isError ? '#ff6b6b' : '#00ff87';
        logDiv.innerHTML += `<div style="color:${color}">[${timestamp}] ${msg}</div>`;
        console.log(`[${timestamp}] ${msg}`);
    }

    async function runDebug() {
        const teamId = document.getElementById('teamIdInput').value;
        document.getElementById('debug-log').innerHTML = "Starting process...<br>";
        
        try {
            // TEST 1: Bootstrap Static
            log(`Step 1: Fetching Bootstrap data...`);
            log(`URL: ${PROXY_URL}${encodeURIComponent(BASE_URL + '/bootstrap-static/')}`);
            
            const bootstrapRes = await fetch(PROXY_URL + encodeURIComponent(BASE_URL + '/bootstrap-static/'));
            log(`Bootstrap Status: ${bootstrapRes.status} ${bootstrapRes.statusText}`);
            
            if (!bootstrapRes.ok) throw new Error(`Bootstrap failed: ${bootstrapRes.status}`);
            
            const bootstrapData = await bootstrapRes.json();
            log(`Bootstrap Data received. Found ${bootstrapData.events.length} events.`);

            // Find current GW
            let currentEvent = bootstrapData.events.find(e => e.is_current);
            if (!currentEvent) {
                 log("No 'is_current' event found. Looking for last finished event...");
                 const finished = bootstrapData.events.filter(e => e.finished);
                 currentEvent = finished[finished.length - 1];
            }

            if (!currentEvent) throw new Error("Could not determine Gameweek.");
            const gw = currentEvent.id;
            log(`Current Gameweek determined: ${gw}`);

            // TEST 2: Team Details
            log(`Step 2: Fetching Team ${teamId} for GW ${gw}...`);
            const picksUrl = `${BASE_URL}/entry/${teamId}/event/${gw}/picks/`;
            const picksRes = await fetch(PROXY_URL + encodeURIComponent(picksUrl));
            
            log(`Team API Status: ${picksRes.status}`);
            
            if (picksRes.status === 404) {
                throw new Error("API returned 404 (Team ID likely doesn't exist or no history for this GW)");
            }
            
            if (!picksRes.ok) {
                 const text = await picksRes.text();
                 throw new Error(`API Error: ${text.substring(0, 100)}`);
            }

            const teamData = await picksRes.json();
            log(`SUCCESS! Points found: ${teamData.entry_history.points}`);
            
            document.getElementById('result').innerText = `Points: ${teamData.entry_history.points}`;

        } catch (err) {
            log(`CRITICAL ERROR: ${err.message}`, true);
            log(`Stack: ${err.stack}`, true);
            alert("Check the black box below for the error details.");
        }
    }
</script>

</body>
</html>
